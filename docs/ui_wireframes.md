# Kirara Academy UI ワイヤーフレーム草案

この文書はフロントエンド実装に先立って必要な画面構成と主要コンポーネントの配置イメージを整理したものです。最終的なビジュアルは後続のデザイン工程で調整しますが、Next.js／React 実装に落とし込む際の骨格として利用してください。

## 1. 画面一覧（フェーズ別概要）

| 画面カテゴリ | 画面名 | 主目的 | 主な要素 |
|:--|:--|:--|:--|
| プリゲーム | ルームロビー | ルーム作成／参加、プレイヤー一覧、開始準備 | ルーム情報、プレイヤーリスト、キャラクター選択への進行ボタン |
| プリゲーム | キャラクター選択 | プレイヤーごとのキャラクター確定 | キャラクターカード一覧、選択済表示、決定ボタン |
| プリゲーム | ターン順決定（任意） | ランダム／手動で順番決定 | 現在の順番、ランダムボタン、手動編集 UI |
| メインゲーム | プレイボード | アクション実行、状態参照 | レイアウト詳細は §2 |
| ポストゲーム | 結果画面 | VP 集計結果表示 | 最終順位、個別詳細、ルーム終了操作 |

以降は最初に実装する優先度の高い 3 画面（ルームロビー／キャラクター選択／プレイボード）を中心に記載します。

## 2. メインプレイボードレイアウト（ラフ）

```
┌─────────────────────────────────────────────┐
│ ヘッダー（ルームID・ラウンド/フェーズ・タイマー等）               │
├───────────────────────────────┬─────────────┤
│ 左サイドバー                                       │ 右サイドバー │
│ ・プレイヤー一覧 / 順番                              │ ・自分の手札 │
│ ・資源／VP／行動力表示                              │ ・アクションログ │
│ ・行動順マーカー                                    │ ・キャラ固有情報 │
├────────────┬──────────────────────┴─────────────┤
│ 中央：共通ボード（研究日誌 + 公開開発カード + レンズ配置）                         │
├────────────┴───────────────────────────────────┤
│ ボトムアクションパネル：選択可能なアクション + コスト/結果プレビュー                 │
└─────────────────────────────────────────────┘
```

### セクション説明

- **ヘッダー**  
  ルーム状況把握のためにラウンド数、現在フェーズ、ターン中プレイヤー、ルーム ID を表示。  
  将来的にはゲームメニュー（離脱、設定表示）も配置。

- **左サイドバー**  
  プレイヤーの順番とステータス（行動力、VP、保有資源）を縦リストで表示。  
  現在手番のプレイヤーを強調。離席／パス済などのフラグもここに反映。

- **右サイドバー**  
  自プレイヤーの詳細にフォーカスした情報群。手札、キャラクター能力、最近のアクションログをタブ形式で切替。  
  「再接続時にここを開けば状況が追える」ことを目的とする。

- **中央ボード**  
  共通領域を複合グリッドで表現。  
  - 上部：研究日誌（公開開発カードと山札）  
  - 中央：配置済みレンズ／ロビー  
  - 下部：タブで課題一覧や共有リソースプールを切替表示  
  ドメイン状態に合わせて `GameState.board` の内容を視覚化。

- **ボトムアクションパネル**  
  `SessionController` にアクション送信する UI。  
  - 左側：選択可能なアクションボタン（ラボ起動、収集、移動、レンズ起動、意思など）  
  - 中央：選択したアクションの入力パネル（対象カード選択など）  
  - 右側：コスト・結果プレビュー、確定ボタン  

## 3. プリゲーム画面の構成

### 3.1 ルームロビー

```
┌───────────────┐
│ ルーム情報：ID / 招待URL / プレイ人数設定         │
├───────────────┤
│ プレイヤーリスト                                   │
│  [host] Host Player    Ready!                       │
│  [ ]    Player Two     Waiting...                   │
│                                               (+招待) │
├───────────────┤
│ キャラクター選択へ進む / 順番決定へ進む             │
└───────────────┘
```

- 状態管理は `SessionClient` を流用しつつ、ルーム開始前の `GameState` を参照。  
- プレイヤーカードに「準備完了・キャラクター選択済」などのステータスバッジを添付。

### 3.2 キャラクター選択

```
┌───────────────────────────┐
│ キャラクターカード一覧（3列グリッド）                 │
│  ┌─────────────┐ ┌─────────────┐ ... │
│  │ [画像]        │ │ [画像]        │     │
│  │ 名前 / 概要    │ │ 名前 / 概要    │     │
│  │ 成長ツリー要約 │ │ 成長ツリー要約 │     │
│  └─────────────┘ └─────────────┘     │
├───────────────────────────┤
│ 選択中キャラ詳細パネル / 決定ボタン                        │
└───────────────────────────┘
```

- 選ばれたキャラクターはグリッド内で非アクティブ表示にする。  
- 決定後はルームロビーに戻るか、全員確定でプレイボードへ遷移。

## 4. Next.js 構成案（実装準備用）

```
apps/web/src/
├─ app/
│  ├─ layout.tsx          ... 共通レイアウト（テーマ調整）
│  ├─ page.tsx            ... 現在のデバッグコンソール（将来はロビー等に差替え）
│  └─ play/
│     └─ page.tsx         ... プレイボード画面
├─ components/
│  ├─ lobby/
│  │  ├─ RoomInfoCard.tsx
│  │  └─ PlayerList.tsx
│  ├─ playboard/
│  │  ├─ BoardView.tsx
│  │  ├─ PlayerSidebar.tsx
│  │  ├─ ActionPanel.tsx
│  │  └─ LogPanel.tsx
│  ├─ ui/
│  │  ├─ Button.tsx
│  │  ├─ Card.tsx
│  │  └─ ResourceBadge.tsx
└─ hooks/
   └─ useSessionClient.ts  ... 既存フックを共通利用
```

- `components/ui` に汎用パーツをまとめ、画面ごとのディレクトリで組み合わせる方針。  
- `SessionClient` から取得した `gameState` / `status` をコンテキスト化して、各コンポーネントに配布することも検討。

## 5. スタイルガイド（初期ドラフト）

開発初期段階で統一感を持たせるための暫定ルール。実際のデザイン調整後に更新予定。

### 5.1 基本トークン

| 種類 | 値 | 備考 |
|:--|:--|:--|
| フォント | `font-family: "Inter", "Noto Sans JP", system-ui;` | 日本語／英語混在に対応。 |
| ベースカラー (背景) | `#0f172a` (dark) / `#f8fafc` (light) | Tailwind slate 系を参考に濃淡で管理。 |
| プライマリカラー | `#2563eb` | アクションボタン・リンク。 |
| セカンダリカラー | `#38bdf8` | 補助的な強調。 |
| 成功 | `#22c55e` | 成功メッセージ、VP 増加など。 |
| 警告 | `#f97316` | コスト不足などの注意表現。 |
| エラー | `#ef4444` | 無効アクションなど。 |
| 余白単位 | 4px グリッド | 小刻みレイアウトで 4 / 8 / 12 / 16 px を基準に。 |

### 5.2 UI コンポーネント指針

- **Button**: Primary / Secondary / Ghost の 3 種類。サイズは `sm` (行内)、`md` (標準)、`lg` (アクション強調)。  
- **Card**: ボーダー＋シャドウ控えめ。タイトル／サブタイトル／コンテンツ領域で構成。  
- **Tab**: サイドバー（手札／ログ切替）や共通ボードの補助に使用。  
- **Badge**: プレイヤーステータス（準備済／パス済）や資源表示に利用。色は `success`, `warning`, `default` の 3 種。  
- **ResourceRow**: 光・虹・淀み・VP・行動力などをアイコン＋数値で横並び表示する共通コンポーネント。  
- **Modal / Drawer**: キャラクター詳細やカード効果説明を表示する際に使用。

### 5.3 レイアウトルール

1. ページ全体は `grid` ベースで構成し、中央ボード領域を最大幅とする。  
2. サイドバー幅は 280px を目安に固定し、ボード領域は残りの幅を使用。  
3. 高さ方向は `min-height: 100vh` で全体を確保し、アクションパネルを常に下部固定。  
4. モバイルでは縦積み（ヘッダー → ボード → アクションパネル）の構成に簡略化。最低限の操作を提供し、詳細 UI は横スクロールやモーダルで対応。

## 6. 実装ロードマップ（SessionClient 連携）

1. **ルート再構成**  
   - `app/page.tsx` をルームロビーに置き換え、既存コンソールは `app/dev-console/page.tsx` に移動。  
   - `app/play/page.tsx` を新設し、`useSessionClient` で取得した状態を `SessionContext` 経由で各コンポーネントへ提供。

2. **共通コンテキスト導入**  
   - `hooks/useSessionClient.ts` を内部で `useMemo` した上で `SessionProvider` を追加。  
   - `SessionProvider` は `gameState`, `status`, `actions` を value とし、ボード各所で `useSession()` フックを利用できるようにする。

3. **プリゲーム実装**  
   - `components/lobby/RoomInfoCard.tsx` と `PlayerList.tsx` を作成し、`SessionProvider` から状態を取得。  
   - キャラクター選択画面では選択アクションを `performAction({ actionType: "selectCharacter" })`（ハンドラー追加予定）に接続。

4. **プレイボード骨組み**  
   - `components/playboard/BoardLayout.tsx`（レイアウトコンテナ）を作成し、`PlayerSidebar`, `BoardView`, `ActionPanel` を配置。  
   - `ActionPanel` で `performAction` をラップした `useActionHandlers`（モーダルやフォームを制御するカスタムフック）を実装。

5. **逐次機能強化**  
   - ログ更新 → `useSessionClient` の `status` や `gameState.logs` を watch。  
   - 持ち時間／タイマーが必要な場合はコンテキストに `timestampProvider` を注入して計算。  
   - 永続化 (`localStorage` ベースの `SessionStore`) を導入し、ブラウザリロード時の即時復元を確認。

## 7. 次のアクション

1. このワイヤーフレーム案を基に、Figma などで簡易モック作成や配色調整を実施。  
2. `apps/web/src/components/ui` 下に共通ボタン／カード等の土台を作成。  
3. 上記ロードマップに沿ってロビー → プレイボードの順にコンポーネント実装を開始。

---

この文書は作業途中で繰り返し更新し、決まった仕様は `KiraraAcademy_design.md` の該当セクションにも反映してください。
